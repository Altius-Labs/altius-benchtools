import json

ERC20_BYTECODE = "0x608060405234801561000f575f80fd5b506004361061009c575f3560e01c8063313ce56711610064578063313ce5671461014657806370a082311461016457806395d89b4114610194578063a9059cbb146101b2578063dd62ed3e146101e25761009c565b806306fdde03146100a0578063095ea7b3146100be5780631249c58b146100ee57806318160ddd146100f857806323b872dd14610116575b5f80fd5b6100a8610212565b6040516100b59190610b0b565b60405180910390f35b6100d860048036038101906100d39190610bbc565b6102a2565b6040516100e59190610c14565b60405180910390f35b6100f66102c4565b005b6101006102e1565b60405161010d9190610c3c565b60405180910390f35b610130600480360381019061012b9190610c55565b6102ea565b60405161013d9190610c14565b60405180910390f35b61014e610318565b60405161015b9190610cc0565b60405180910390f35b61017e60048036038101906101799190610cd9565b610320565b60405161018b9190610c3c565b60405180910390f35b61019c610365565b6040516101a99190610b0b565b60405180910390f35b6101cc60048036038101906101c79190610bbc565b6103f5565b6040516101d99190610c14565b60405180910390f35b6101fc60048036038101906101f79190610d04565b610417565b6040516102099190610c3c565b60405180910390f35b60606003805461022190610d6f565b80601f016020809104026020016040519081016040528092919081815260200182805461024d90610d6f565b80156102985780601f1061026f57610100808354040283529160200191610298565b820191905f5260205f20905b81548152906001019060200180831161027b57829003601f168201915b5050505050905090565b5f806102ac610499565b90506102b98185856104a0565b600191505092915050565b6102df6102cf610499565b69d3c21bcecceda10000006104b2565b565b5f600254905090565b5f806102f4610499565b9050610301858285610531565b61030c8585856105c3565b60019150509392505050565b5f6012905090565b5f805f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b60606004805461037490610d6f565b80601f01602080910402602001604051908101604052809291908181526020018280546103a090610d6f565b80156103eb5780601f106103c2576101008083540402835291602001916103eb565b820191905f5260205f20905b8154815290600101906020018083116103ce57829003601f168201915b5050505050905090565b5f806103ff610499565b905061040c8185856105c3565b600191505092915050565b5f60015f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905092915050565b5f33905090565b6104ad83838360016106b3565b505050565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610522575f6040517fec442f050000000000000000000000000000000000000000000000000000000081526004016105199190610dae565b60405180910390fd5b61052d5f8383610882565b5050565b5f61053c8484610417565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81146105bd57818110156105ae578281836040517ffb8f41b20000000000000000000000000000000000000000000000000000000081526004016105a593929190610dc7565b60405180910390fd5b6105bc84848484035f6106b3565b5b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610633575f6040517f96c6fd1e00000000000000000000000000000000000000000000000000000000815260040161062a9190610dae565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036106a3575f6040517fec442f0500000000000000000000000000000000000000000000000000000000815260040161069a9190610dae565b60405180910390fd5b6106ae838383610882565b505050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603610723575f6040517fe602df0500000000000000000000000000000000000000000000000000000000815260040161071a9190610dae565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610793575f6040517f94280d6200000000000000000000000000000000000000000000000000000000815260040161078a9190610dae565b60405180910390fd5b8160015f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550801561087c578273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040516108739190610c3c565b60405180910390a35b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036108d2578060025f8282546108c69190610e29565b925050819055506109a0565b5f805f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205490508181101561095b578381836040517fe450d38c00000000000000000000000000000000000000000000000000000000815260040161095293929190610dc7565b60405180910390fd5b8181035f808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036109e7578060025f8282540392505081905550610a31565b805f808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610a8e9190610c3c565b60405180910390a3505050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f610add82610a9b565b610ae78185610aa5565b9350610af7818560208601610ab5565b610b0081610ac3565b840191505092915050565b5f6020820190508181035f830152610b238184610ad3565b905092915050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610b5882610b2f565b9050919050565b610b6881610b4e565b8114610b72575f80fd5b50565b5f81359050610b8381610b5f565b92915050565b5f819050919050565b610b9b81610b89565b8114610ba5575f80fd5b50565b5f81359050610bb681610b92565b92915050565b5f8060408385031215610bd257610bd1610b2b565b5b5f610bdf85828601610b75565b9250506020610bf085828601610ba8565b9150509250929050565b5f8115159050919050565b610c0e81610bfa565b82525050565b5f602082019050610c275f830184610c05565b92915050565b610c3681610b89565b82525050565b5f602082019050610c4f5f830184610c2d565b92915050565b5f805f60608486031215610c6c57610c6b610b2b565b5b5f610c7986828701610b75565b9350506020610c8a86828701610b75565b9250506040610c9b86828701610ba8565b9150509250925092565b5f60ff82169050919050565b610cba81610ca5565b82525050565b5f602082019050610cd35f830184610cb1565b92915050565b5f60208284031215610cee57610ced610b2b565b5b5f610cfb84828501610b75565b91505092915050565b5f8060408385031215610d1a57610d19610b2b565b5b5f610d2785828601610b75565b9250506020610d3885828601610b75565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680610d8657607f821691505b602082108103610d9957610d98610d42565b5b50919050565b610da881610b4e565b82525050565b5f602082019050610dc15f830184610d9f565b92915050565b5f606082019050610dda5f830186610d9f565b610de76020830185610c2d565b610df46040830184610c2d565b949350505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f610e3382610b89565b9150610e3e83610b89565b9250828201905080821115610e5657610e55610dfc565b5b9291505056fea2646970667358221220ad017518072cb4ae99187c562a54a73900f974e515c9d016bcbfe2dd6879211664736f6c634300081a0033"

ERC20P_BYTECODE = "0x608060405234801561000f575f80fd5b5060043610610060575f3560e01c8063062fd1ae1461006457806318160ddd146100825780635ee04378146100a057806370a08231146100d0578063802fb32714610100578063a9059cbb1461011c575b5f80fd5b61006c61014c565b60405161007991906103e4565b60405180910390f35b61008a610151565b6040516100979190610415565b60405180910390f35b6100ba60048036038101906100b591906104b6565b610157565b6040516100c79190610415565b60405180910390f35b6100ea60048036038101906100e591906104f4565b61017a565b6040516100f79190610415565b60405180910390f35b61011a60048036038101906101159190610549565b61020a565b005b610136600480360381019061013191906104b6565b6102db565b60405161014391906105b3565b60405180910390f35b600881565b60015481565b5f602052815f5260405f20816008811061016f575f80fd5b015f91509150505481565b5f805f90505f5b600861ffff168161ffff161015610200575f808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f208161ffff16600881106101e4576101e36105cc565b5b0154826101f19190610626565b91508080600101915050610181565b5080915050919050565b600861ffff168261ffff1610610255576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161024c906106b3565b60405180910390fd5b805f808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f208361ffff16600881106102a8576102a76105cc565b5b015f8282546102b79190610626565b925050819055508060015f8282546102cf9190610626565b92505081905550505050565b5f806007841690505f600733169050835f803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f208361ffff166008811061033d5761033c6105cc565b5b015f82825461034c91906106d1565b92505081905550835f808773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f208261ffff16600881106103a6576103a56105cc565b5b015f8282546103b59190610626565b9250508190555060019250505092915050565b5f61ffff82169050919050565b6103de816103c8565b82525050565b5f6020820190506103f75f8301846103d5565b92915050565b5f819050919050565b61040f816103fd565b82525050565b5f6020820190506104285f830184610406565b92915050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61045b82610432565b9050919050565b61046b81610451565b8114610475575f80fd5b50565b5f8135905061048681610462565b92915050565b610495816103fd565b811461049f575f80fd5b50565b5f813590506104b08161048c565b92915050565b5f80604083850312156104cc576104cb61042e565b5b5f6104d985828601610478565b92505060206104ea858286016104a2565b9150509250929050565b5f602082840312156105095761050861042e565b5b5f61051684828501610478565b91505092915050565b610528816103c8565b8114610532575f80fd5b50565b5f813590506105438161051f565b92915050565b5f805f606084860312156105605761055f61042e565b5b5f61056d86828701610478565b935050602061057e86828701610535565b925050604061058f868287016104a2565b9150509250925092565b5f8115159050919050565b6105ad81610599565b82525050565b5f6020820190506105c65f8301846105a4565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f610630826103fd565b915061063b836103fd565b9250828201905080821115610653576106526105f9565b5b92915050565b5f82825260208201905092915050565b7f736c6f7420746f6f2062696700000000000000000000000000000000000000005f82015250565b5f61069d600c83610659565b91506106a882610669565b602082019050919050565b5f6020820190508181035f8301526106ca81610691565b9050919050565b5f6106db826103fd565b91506106e6836103fd565b92508282039050818111156106fe576106fd6105f9565b5b9291505056fea26469706673582212203422bc81ded388d632ebf00efe87c6b356947bc057ef0204576a321df659c27064736f6c634300081a0033"

file = "./data/test_case_erc20.json"
origin = json.load(open(file))

code_flag = False
for addr, prestate in origin['just-test']['pre'].items():
    if prestate['code'] == ERC20_BYTECODE:
        if code_flag:
            raise Exception("More than one ERC20 contract found")
        code_flag = True
        prestate['code'] = ERC20P_BYTECODE
        storage_keys = list(prestate['storage'].keys())
        for storage_key in storage_keys:
            for i in range(1, 8):
                new_storage_key = '0x' + hex(int(storage_key, 16) + i)[2:].rjust(64, '0')
                prestate['storage'][new_storage_key] = prestate['storage'][storage_key]
        prestate['storage'] = json.loads(json.dumps(prestate['storage'], sort_keys=True))
        origin['just-test']['pre'][addr] = prestate

json.dump(origin, open("./data/test_case_erc20p.json", "w"), indent=2)